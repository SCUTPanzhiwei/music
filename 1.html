<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>
    var findAnagrams = function (s, p) {
      // 有效
      let count = 0
      let need = new Map()
      let vaild = new Map()
      for (let i = 0; i < p.length; i++) {
        if (need.has(p[i])) {
          need.set(p[i], need.get(p[i]) + 1)
        } else {
          need.set(p[i], 1)
        }
      }
      let l = 0
      let r = 0
      let res = []
      while (r < s.length) {
        // 即将移入窗口的数据
        let cur = s[r]
        // 右移窗口
        r++
        // 探测窗口扩大
        if (need.has(cur)) {
          if (vaild.has(cur)) {
            vaild.set(cur, vaild.get(cur) + 1)
          } else {
            vaild.set(cur, 1)
          }
          if (vaild.get(cur) === need.get(cur)) {
            count++
          }
        }
        // 数据输出
        if (count == need.size) {
          res.push(l)
        }
        // 什么时候需要收缩窗口 当前窗口的长度==
        while ((r - l) == p.length) {
          let d = s[l]
          l++
          // 如果当前字符为候选字符
          if (need.has(d)) {
            // 如果有效
            if (vaild.get(d) == need.get(d)) {
              count--
            }
            vaild.set(d, vaild.get(d) - 1)
          }
        }
      }
      return res
    };
    findAnagrams("cbaebabacd","abc")
  </script>
</body>

</html>